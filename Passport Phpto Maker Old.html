<!-- Old Code -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>

<style>
/* Full Screen/Responsive Styling */
#passport-photo-app {
    min-height: 100vh;
    width: 100%;
    margin: -8px; /* ‡§¨‡•ç‡§≤‡•â‡§ó‡§∞ ‡§ï‡•á ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§Æ‡§æ‡§∞‡•ç‡§ú‡§ø‡§® ‡§ï‡•ã ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡§æ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ */
    padding: 20px;
    box-sizing: border-box;
    background-color: #f7f7f7; /* ‡§π‡§≤‡•ç‡§ï‡§æ ‡§ó‡•ç‡§∞‡•á ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° */
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start; /* ‡§ä‡§™‡§∞ ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç */
    text-align: center;
}

h2 {
    color: #333;
    margin-bottom: 20px;
}

/* ‡§°‡•ç‡§∞‡•à‡§ó-‡§è‡§Ç‡§°-‡§°‡•ç‡§∞‡•â‡§™ ‡§è‡§∞‡§ø‡§Ø‡§æ */
#drop-area {
    border: 3px dashed #007bff;
    border-radius: 15px;
    padding: 40px;
    width: 90%;
    max-width: 700px;
    margin-bottom: 30px;
    cursor: pointer;
    background-color: #fff;
    transition: background-color 0.3s;
}

#drop-area.highlight {
    background-color: #e6f7ff;
}

#file-input {
    display: none;
}

.button {
    display: inline-block;
    padding: 10px 25px;
    margin: 10px 5px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-decoration: none;
    font-weight: bold;
    font-size: 16px;
    transition: background-color 0.3s, transform 0.2s;
}

.button:hover {
    background-color: #0056b3;
    transform: translateY(-2px);
}

.primary-button {
    background-color: #28a745;
}

.primary-button:hover {
    background-color: #1e7e34;
}

.download-button {
    background-color: #ffc107;
    color: #333;
}

/* ‡§á‡§Æ‡•á‡§ú ‡§î‡§∞ ‡§ï‡•ç‡§∞‡•â‡§™‡§∞ ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ */
#image-container {
    width: 90%;
    max-width: 700px;
    max-height: 60vh; /* ‡§Ö‡§ß‡§ø‡§ï‡§§‡§Æ ‡§ä‡§Ç‡§ö‡§æ‡§à */
    margin-bottom: 20px;
    display: none; /* ‡§∂‡•Å‡§∞‡•Ç ‡§Æ‡•á‡§Ç ‡§õ‡§ø‡§™‡§æ ‡§π‡•Å‡§Ü */
}

/* Cropper.js ‡§ï‡•á ‡§≤‡§ø‡§è ‡•õ‡§∞‡•Ç‡§∞‡•Ä */
#image-to-crop {
    max-width: 100%;
    max-height: 100%;
    display: block;
}

/* ‡§®‡§ø‡§Ø‡§Ç‡§§‡•ç‡§∞‡§£ ‡§™‡•à‡§®‡§≤ */
#controls {
    width: 90%;
    max-width: 700px;
    padding: 15px;
    background-color: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    display: none; /* ‡§∂‡•Å‡§∞‡•Ç ‡§Æ‡•á‡§Ç ‡§õ‡§ø‡§™‡§æ ‡§π‡•Å‡§Ü */
}

#controls label {
    display: block;
    margin: 10px 0;
    font-weight: bold;
}

/* ‡§´‡§æ‡§á‡§®‡§≤ ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü */
#output-area {
    width: 90%;
    max-width: 700px;
    margin-top: 30px;
    padding: 20px;
    background-color: #fff;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    display: none;
}

#final-image-preview {
    max-width: 100%;
    height: auto;
    border: 1px solid #ccc;
    margin-bottom: 15px;
}

/* ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤/‡§ü‡•à‡§¨‡§≤‡•á‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∞‡§ø‡§∏‡•ç‡§™‡•â‡§®‡•ç‡§∏‡§ø‡§µ ‡§è‡§°‡§ú‡§∏‡•ç‡§ü‡§Æ‡•á‡§Ç‡§ü */
@media (max-width: 768px) {
    #passport-photo-app {
        padding: 10px;
        align-items: stretch;
    }
    #drop-area, #image-container, #controls, #output-area {
        width: 100%;
        max-width: none;
    }
}
</style>

<div id="passport-photo-app">
    <h2>üáÆüá≥ ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§´‡•ã‡§ü‡•ã ‡§ï‡•ç‡§∞‡•â‡§™‡§∞</h2>
    
    <div id="drop-area">
        <p>‡•û‡•ã‡§ü‡•ã ‡§Ø‡§π‡§æ‡§Ç **‡§°‡•ç‡§∞‡•â‡§™** ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ</p>
        <input type="file" id="file-input" accept="image/*" />
        <label for="file-input" class="button">‡•û‡§æ‡§á‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç</label>
        <p style="font-size: 14px; color: #777;">*‡§ï‡•á‡§µ‡§≤ JPEG/PNG ‡§á‡§Æ‡•á‡§ú ‡§π‡•Ä ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü‡•á‡§° ‡§π‡•à‡§Ç‡•§</p>
    </div>

    <div id="image-container">
        <img id="image-to-crop" src="" alt="Image to Crop" style="display:none;">
    </div>

    <div id="controls">
        <label>
            <input type="checkbox" id="add-border-checkbox" checked> 
            **‡§∏‡§´‡•á‡§¶ ‡§¨‡•â‡§∞‡•ç‡§°‡§∞ (Stock) ‡§ú‡•ã‡§°‡§º‡•á‡§Ç** (‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§´‡•ã‡§ü‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è ‡•õ‡§∞‡•Ç‡§∞‡•Ä)
        </label>
        
        <button id="crop-button" class="button primary-button">
            ‡§ï‡•ç‡§∞‡•â‡§™ ‡§î‡§∞ ‡•û‡•ã‡§ü‡•ã ‡§§‡•à‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡•á‡§Ç
        </button>
    </div>

    <div id="output-area">
        <h3>‡§§‡•à‡§Ø‡§æ‡§∞ ‡•û‡•ã‡§ü‡•ã</h3>
        <img id="final-image-preview" src="" alt="Final Passport Photo">
        <a id="download-link" class="button download-button" download="indian_passport_photo.jpeg">
            ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç
        </a>
    </div>
</div>

<script>
const fileInput = document.getElementById('file-input');
const dropArea = document.getElementById('drop-area');
const imageToCrop = document.getElementById('image-to-crop');
const imageContainer = document.getElementById('image-container');
const controls = document.getElementById('controls');
const cropButton = document.getElementById('crop-button');
const finalImagePreview = document.getElementById('final-image-preview');
const downloadLink = document.getElementById('download-link');
const outputArea = document.getElementById('output-area');
const addBorderCheckbox = document.getElementById('add-border-checkbox');

let cropper;
const PASSPORT_ASPECT_RATIO = 3.5 / 4.5; // ‡§á‡§Ç‡§°‡§ø‡§Ø‡§® ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§æ‡§á‡•õ ‡§ï‡§æ ‡§Ö‡§®‡•Å‡§™‡§æ‡§§ (3.5cm ‡§ö‡•å‡§°‡§º‡§æ‡§à x 4.5cm ‡§ä‡§Ç‡§ö‡§æ‡§à)

// --- Drag/Drop ‡§î‡§∞ ‡§´‡§º‡§æ‡§á‡§≤ ‡§π‡•à‡§Ç‡§°‡§≤‡§ø‡§Ç‡§ó ---
['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, preventDefaults, false);
});

['dragenter', 'dragover'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.add('highlight'), false);
});

['dragleave', 'drop'].forEach(eventName => {
    dropArea.addEventListener(eventName, () => dropArea.classList.remove('highlight'), false);
});

dropArea.addEventListener('drop', (e) => {
    handleFiles(e.dataTransfer.files);
}, false);

fileInput.addEventListener('change', (e) => {
    handleFiles(e.target.files);
});

function preventDefaults(e) {
    e.preventDefault();
    e.stopPropagation();
}

function handleFiles(files) {
    if (files.length === 0 || !files[0].type.startsWith('image/')) {
        alert('‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡§á‡§Æ‡•á‡§ú ‡§´‡§º‡§æ‡§á‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç‡•§');
        return;
    }
    
    const file = files[0];
    const reader = new FileReader();

    reader.onload = (e) => {
        // 1. Cropper ‡§ï‡•ã ‡§®‡§∑‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (‡§Ö‡§ó‡§∞ ‡§Ø‡§π ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ö‡§≤ ‡§∞‡§π‡§æ ‡§π‡•à)
        if (cropper) {
            cropper.destroy();
        }

        // 2. ‡§á‡§Æ‡•á‡§ú ‡§™‡•ç‡§∞‡§¶‡§∞‡•ç‡§∂‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ UI ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
        imageToCrop.src = e.target.result;
        imageToCrop.style.display = 'block';
        imageContainer.style.display = 'block';
        dropArea.style.display = 'none'; // ‡§°‡•ç‡§∞‡•â‡§™ ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§õ‡§ø‡§™‡§æ‡§è‡§Å
        controls.style.display = 'block';
        outputArea.style.display = 'none'; // ‡§™‡§ø‡§õ‡§≤‡§æ ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§õ‡§ø‡§™‡§æ‡§è‡§Å

        // 3. Cropper.js ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç
        cropper = new Cropper(imageToCrop, {
            aspectRatio: PASSPORT_ASPECT_RATIO,
            viewMode: 1, // ‡§ï‡•ç‡§∞‡•â‡§™‡§∞ ‡§ï‡•ã ‡§ï‡§Ç‡§ü‡•á‡§®‡§∞ ‡§ï‡•á ‡§∏‡§æ‡§á‡•õ ‡§Æ‡•á‡§Ç ‡§´‡§ø‡§ü ‡§ï‡§∞‡•á‡§Ç
            dragMode: 'move',
            autoCropArea: 0.8, // ‡§∏‡•ç‡§µ‡§ö‡§æ‡§≤‡§ø‡§§ ‡§ï‡•ç‡§∞‡•â‡§™ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞
            responsive: true,
            background: false,
        });
    };
    
    reader.readAsDataURL(file);
}

// --- ‡§ï‡•ç‡§∞‡•â‡§™ ‡§î‡§∞ ‡§á‡§Æ‡•á‡§ú ‡§¨‡§®‡§æ‡§®‡•á ‡§ï‡§æ ‡§≤‡•â‡§ú‡§ø‡§ï ---

cropButton.addEventListener('click', () => {
    if (!cropper) {
        alert('‡§™‡§π‡§≤‡•á ‡§ï‡•É‡§™‡§Ø‡§æ ‡§è‡§ï ‡•û‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç‡•§');
        return;
    }

    // Cropper ‡§∏‡•á ‡§ï‡•ç‡§∞‡•â‡§™ ‡§ï‡§ø‡§è ‡§ó‡§è Canvas ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç
    const croppedCanvas = cropper.getCroppedCanvas({
        width: 350,  // 3.5cm ‡§ï‡•ã 350px ‡§Æ‡§æ‡§® ‡§≤‡•á‡§Ç (DPI ‡§ï‡•á ‡§≤‡§ø‡§è)
        height: 450, // 4.5cm ‡§ï‡•ã 450px ‡§Æ‡§æ‡§® ‡§≤‡•á‡§Ç
        fillColor: '#fff',
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high',
    });

    const needBorder = addBorderCheckbox.checked;

    if (needBorder) {
        // ‡§¨‡•â‡§∞‡•ç‡§°‡§∞ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§®‡§Ø‡§æ Canvas ‡§¨‡§®‡§æ‡§è‡§Å
        const borderSize = 10; // 10px ‡§∏‡§´‡•á‡§¶ ‡§¨‡•â‡§∞‡•ç‡§°‡§∞
        const finalCanvas = document.createElement('canvas');
        finalCanvas.width = croppedCanvas.width + 2 * borderSize;
        finalCanvas.height = croppedCanvas.height + 2 * borderSize;
        const ctx = finalCanvas.getContext('2d');

        // ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§ï‡•ã ‡§∏‡§´‡•á‡§¶ ‡§∞‡§Ç‡§ó ‡§∏‡•á ‡§≠‡§∞‡•á‡§Ç (‡§¨‡•â‡§∞‡•ç‡§°‡§∞)
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);

        // ‡§ï‡•ç‡§∞‡•â‡§™ ‡§ï‡•Ä ‡§ó‡§à ‡§á‡§Æ‡•á‡§ú ‡§ï‡•ã ‡§¨‡•â‡§∞‡•ç‡§°‡§∞ ‡§ï‡•á ‡§Ö‡§Ç‡§¶‡§∞ ‡§°‡•ç‡§∞‡§æ ‡§ï‡§∞‡•á‡§Ç
        ctx.drawImage(croppedCanvas, borderSize, borderSize);

        // ‡§´‡§æ‡§á‡§®‡§≤ ‡§á‡§Æ‡•á‡§ú ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü
        generateOutput(finalCanvas);
    } else {
        // ‡§¨‡•â‡§∞‡•ç‡§°‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§ö‡§æ‡§π‡§ø‡§è, ‡§∏‡•Ä‡§ß‡•á ‡§ï‡•ç‡§∞‡•â‡§™ ‡§ï‡•Ä ‡§ó‡§à ‡§á‡§Æ‡•á‡§ú ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç
        generateOutput(croppedCanvas);
    }
});

function generateOutput(canvasElement) {
    // Canvas ‡§ï‡•ã JPEG ‡§°‡•á‡§ü‡§æ URL ‡§Æ‡•á‡§Ç ‡§¨‡§¶‡§≤‡•á‡§Ç
    // JPEG ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§Ö‡§ï‡•ç‡§∏‡§∞ ‡§™‡§æ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§´‡•ã‡§ü‡•ã ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à
    const finalImageURL = canvasElement.toDataURL('image/jpeg', 0.95);

    // ‡§Ü‡§â‡§ü‡§™‡•Å‡§ü ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
    finalImagePreview.src = finalImageURL;
    downloadLink.href = finalImageURL;
    outputArea.style.display = 'block';

    // (‡§µ‡•à‡§ï‡§≤‡•ç‡§™‡§ø‡§ï) Cropper ‡§ï‡•ã ‡§®‡§∑‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ UI ‡§ï‡•ã ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç
    // cropper.destroy();
    // imageContainer.style.display = 'none';
    // controls.style.display = 'none';
    // dropArea.style.display = 'block';
}

// ‡§∂‡•Å‡§∞‡•Ç ‡§Æ‡•á‡§Ç ‡§°‡•ç‡§∞‡•â‡§™ ‡§è‡§∞‡§ø‡§Ø‡§æ ‡§ï‡•ã ‡§°‡§ø‡§∏‡•ç‡§™‡•ç‡§≤‡•á ‡§ï‡§∞‡•á‡§Ç
window.onload = () => {
    dropArea.style.display = 'block';
};
</script>

<!-- old code End -->